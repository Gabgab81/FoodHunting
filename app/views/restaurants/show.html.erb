<h1> <%= @restaurant.name %> </h1>

<% if @restaurant.photos.attached? %>
  <% @restaurant.photos.each do |photo| %>
    <%= cl_image_tag photo.key, height: 300, width: 400, crop: :fill %>
  <% end %>
<% else %>
  <p>No picture available</p>
<% end %>
<h4>From: <%= User.find(@restaurant.user_id).nickname  %> </h4>

<p>Adress: <%= @restaurant.address %> </p>

<p>Call us: <%= @restaurant.phone %> </p>


<% @restaurant.schedules.each do |schedule| %>
    <% if schedule.am_closes_at.nil? %>
        <p><%= weekdays[schedule.weekday - 1][:label] %> : <%= schedule.am_opens_at.strftime("%H:%M") %> - <%= schedule.pm_closes_at.strftime("%H:%M") %></p>
    <% else %>
    <p><%= weekdays[schedule.weekday - 1][:label] %>:
        <%= schedule.am_opens_at.strftime("%H:%M") %> - <%= schedule.am_closes_at.strftime("%H:%M") %> / 
        <%= schedule.pm_opens_at.strftime("%H:%M") %> - <%= schedule.pm_closes_at.strftime("%H:%M") %>
    </p>
    <% end %>
<% end %>

<% if @restaurant.open? %>
    <p><%= @restaurant.name %> is open. It will close in <%= @restaurant.whenClose  %></p>
<% else %>
    <p><%= @restaurant.name %> is closed. It will open in <%= @restaurant.whenOpen  %></p>
<% end %>

<div style="width: 50%; height: 200px;"
  data-controller="map"
  data-map-markers-value="<%= @markers.to_json %>"
  data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
</div>
<% if current_user.favorites.where(restaurant_id: @restaurant).empty? %>
  <%= simple_form_for [@restaurant, @favorite] do |f| %>
    <%= f.submit "Favorite" %>
  <% end %>
<% else %>
  <%= link_to "Favorite",
                favorite_path(@favorite),
                method: :delete %>
<% end %>
<p>Favorite? : <%= @favorite.id.nil? ? "no" : "yes" %></p>

<% if @restaurant.rating.nil? %>
  <p>No rated yet.</p>
<% else %>
  <p>Rating: <%= @restaurant.rating %> </p>
<% end %>

<% if Ratingr.find_by(user_id: current_user, restaurant_id: @restaurant).nil? %>
  <%= simple_form_for [@restaurant, @ratingr] do |f| %>
    <%= f.input :content, collection: (1..5).to_a, label: "Rate the restaurant" %>
    <%= f.submit "Submit yout rating" %>
  <% end %>
<% else %>
  <p>Your rating is <%= Ratingr.find_by(user_id: current_user, restaurant_id: @restaurant).content %>/5</p>
<% end %>

<p>Menu: </p>
<% @restaurant.meals.each do |meal| %>
    <p> <%="#{meal.name}, price: #{meal.price}$"  %> 
    <%= link_to "Show the meal", meal_path(meal)  %> 
    <% if current_user.id == @restaurant.user_id %>
    <%= link_to "Modify the meal", edit_restaurant_meal_path(meal.restaurant_id, meal.id)  %> 
    <%= link_to "Delete #{meal.name}",
                meal_path(meal),
                method: :delete,
                data: { confirm: "Are you sure?" } %>
    <% end %></p>
<% end %>

<%= link_to "Back", restaurants_path  %>

<% if current_user.id == @restaurant.user_id %>
    <%= link_to "Create new meal", new_restaurant_meal_path(@restaurant)  %>
    <%= link_to "Modifiy #{@restaurant.name}", edit_restaurant_path(@restaurant)  %>
    <%= link_to "Delete #{@restaurant.name}",
                restaurant_path(@restaurant),
                method: :delete,
                data: { confirm: "Are you sure?" } %>
<% end %>
<p></p>
<div data-controller="insert-in-list">
  <div data-insert-in-list-target="items">
    <% @restaurant.comments.each do |comment| %>
        <%= render 'comments/comment', comment: comment %>
    <% end %>
  </div>

  <%= render 'comments/form', restaurant: @restaurant, comment: @comment %>
</div>
