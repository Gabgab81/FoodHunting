<div class="form-restaurant">

    <%= simple_form_for(@restaurant) do |f| %>
    <div class="restaurant-schedule">
    
        <div class="info-restaurant">

            <h2>Your restaurant details</h2>

            <div class="info">
                
                <%= f.input :name, label: false, placeholder: 'Name' %>
                <%= f.input :address, label: false,
                input_html: {data: {address_autocomplete_target: "address"}, class: "d-none"},
                wrapper_html: {data: {controller: "address-autocomplete", address_autocomplete_api_key_value: ENV["MAPBOX_API_KEY"]}} %>
                <%= f.input :description, label: false, placeholder: 'Description' %>
                <%= f.input :phone, label: false, placeholder: "The phone number: (x-xxx-xxx-xxxx)" %>
                <%= f.input :photos, label: "Upload some pictures", as: :file, input_html: { multiple: true } %>
            </div>
            

        </div>
        
        <%# Schedule table %>

        <div class="info-schedule">

            <h2>Your restaurant schedule</h2>

            <div class="info">
            
                <table class="schedule-editor">
                    <thead>
                        <tr>
                        <th>Day*</th>
                        <th>Opens at*</th>
                        <th>Closes at</th>
                        <th>Opens at</th>
                        <th>Closes at*</th>
                        </tr>
                    </thead>

                    <tbody>    
                        <% weekdays.each do |day| %>      
                            <%= f.fields_for :schedules, f.object.schedules.find_or_initialize_by(weekday: day[:value]) do |sched| %>        
                                <tr>          
                                    <td>
                                        <%= sched.hidden_field :weekday %>
                                        <div class="checkbox">
                                        <%# hello %>
                                        <%= sched.check_box :_destroy, {checked: sched.object.persisted?}, "0", "1" %>
                                        <%= sched.label :_destroy, day[:label] %>
                                        </div>
                                    </td>          
                                    <td>
                                        <%= sched.label :am_opens_at, class: "visually-hidden" %>
                                        <%= sched.time_field :am_opens_at %>
                                    </td>          
                                    <td>
                                        <%= sched.label :am_closes_at, class: "visually-hidden" %>
                                        <%= sched.time_field :am_closes_at %>
                                    </td> 
                                    <td>
                                        <%= sched.label :pm_opens_at, class: "visually-hidden" %>
                                        <%= sched.time_field :pm_opens_at %>
                                    </td>          
                                    <td>
                                        <%= sched.label :pm_closes_at, class: "visually-hidden" %>
                                        <%= sched.time_field :pm_closes_at %>
                                    </td> 
                                </tr>
                                <tr>
                                    <td>
                                    </td>
                                    <td>
                                        
                                        <% invalid = invalid?("schedules.am_opens_at", day) %>

                                        <% if invalid %>
                                            <div class="invalid-feedback d-block">
                                            <% @restaurant.errors.full_messages_for("schedules.am_opens_at").each do |error_message| %>
                                                <%= error_message %>.
                                            <% end %>
                                        </div>
                                        <% end %>

                                    </td>

                                    <td>
                                    
                                        <% invalid = invalid?("schedules.am_closes_at", day) %>

                                        <% if invalid %>
                                            <div class="invalid-feedback d-block">
                                            <% @restaurant.errors.full_messages_for("schedules.am_closes_at").each do |error_message| %>
                                                <%= error_message %>.
                                            <% end %>
                                            </div>
                                        <% end %>
                                    
                                    </td>

                                    <td>

                                        <% invalid = invalid?("schedules.pm_opens_at", day) %>

                                        <% if invalid %>
                                            <div class="invalid-feedback d-block">
                                            <% @restaurant.errors.full_messages_for("schedules.pm_opens_at").each do |error_message| %>
                                                <%= error_message %>.
                                            <% end %>
                                            </div>
                                        <% end %>

                                    </td> 
                                    
                                    <td>

                                        <% invalid = invalid?("schedules.pm_closes_at", day) %>

                                        <% if invalid %>
                                            <div class="invalid-feedback d-block">
                                            <% @restaurant.errors.full_messages_for("schedules.pm_closes_at").each do |error_message| %>
                                                <%= error_message %>.
                                            <% end %>
                                            </div>
                                        <% end %>

                                    </td>

                                </tr>   
                                <tr>
                                    <% if  !invalid?("schedules.am_opens_at", day) && !invalid?("schedules.am_closes_at", day) && invalid?("schedules.pm_opens_at", day) && invalid?("schedules.pm_closes_at", day)  %>
                                        <p>If you don't close at noon, use the "open at" and the close at" with a *.</p>
                                    <% end %>
                                </tr>  
                            <% end %>    

                        <% end %>  
                    </tbody>
                </table>
                <% invalid = @restaurant.errors.include?(:schedules) %>
                <% if invalid %>
                    <div class="invalid-feedback d-block">
                        <% @restaurant.errors.full_messages_for(:schedules).each do |error_message| %>
                        <%= error_message %>.
                        <% end %>
                    </div>
                <% end %>
                <p>* mandatory</p>

            </div>
            <%# <p>If your restaurant doesn't close at noon</p> %>
            
        </div>

        
    </div>

    
    <%# Schedule table %>
    <div class="submit-back">
            <%= f.submit "Create your restaurant" %>
        <% end %>
    
        <%= link_to "Back", restaurants_path %>
    </div>   
    

</div>