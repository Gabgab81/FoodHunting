<%= simple_form_for(@restaurant) do |f| %>
  <%= f.input :name %>
  <%= f.input :address,
  input_html: {data: {address_autocomplete_target: "address"}, class: "d-none"},
  wrapper_html: {data: {controller: "address-autocomplete", address_autocomplete_api_key_value: ENV["MAPBOX_API_KEY"]}} %>
  <%= f.input :description %>
  <%= f.input :phone, label: "Phone (x-xxx-xxx-xxxx)" %>
  <%= f.input :photos, as: :file, input_html: { multiple: true } %>
  
  <%# Schedule table %>
  <p>* mandatory</p>
  <table class="schedule-editor">
  <thead>
      <tr>
      <th>Day*</th>
      <th>Opens at*</th>
      <th>Closes at</th>
      <th>Opens at</th>
      <th>Closes at*</th>
      </tr>
  </thead>

  <tbody>    
      <% weekdays.each do |day| %>      
      <%= f.fields_for :schedules, f.object.schedules.find_or_initialize_by(weekday: day[:value]) do |sched| %>        
          <tr>          
          <td>
              <%= sched.hidden_field :weekday %>
              <div class="checkbox">
              <%= sched.check_box :_destroy, {checked: sched.object.persisted?}, "0", "1" %>
              <%= sched.label :_destroy, day[:label] %>
              </div>
          </td>          
          <td>
              <%= sched.label :am_opens_at, class: "visually-hidden" %>
              <%= sched.time_field :am_opens_at %>
          </td>          
          <td>
              <%= sched.label :am_closes_at, class: "visually-hidden" %>
              <%= sched.time_field :am_closes_at %>
          </td> 
          <td>
              <%= sched.label :pm_opens_at, class: "visually-hidden" %>
              <%= sched.time_field :pm_opens_at %>
          </td>          
          <td>
              <%= sched.label :pm_closes_at, class: "visually-hidden" %>
              <%= sched.time_field :pm_closes_at %>
          </td> 
          <td>
              
              <% invalid = invalid?("schedules.am_opens_at", day) %>

              <% if invalid %>
                  <div class="invalid-feedback d-block">
                  <% @restaurant.errors.full_messages_for("schedules.am_opens_at").each do |error_message| %>
                      <%= error_message %>.
                  <% end %>
              </div>
              <% end %>

              <% invalid = invalid?("schedules.pm_closes_at", day) %>

              <% if invalid %>
                  <div class="invalid-feedback d-block">
                  <% @restaurant.errors.full_messages_for("schedules.pm_closes_at").each do |error_message| %>
                      <%= error_message %>.
                  <% end %>
                  </div>
              <% end %>

              <% invalid = invalid?("schedules.am_closes_at", day) %>

              <% if invalid %>
                  <div class="invalid-feedback d-block">
                  <% @restaurant.errors.full_messages_for("schedules.am_closes_at").each do |error_message| %>
                      <%= error_message %>.
                  <% end %>
                  </div>
              <% end %>

              <% invalid = invalid?("schedules.pm_opens_at", day) %>

              <% if invalid %>
                  <div class="invalid-feedback d-block">
                  <% @restaurant.errors.full_messages_for("schedules.pm_opens_at").each do |error_message| %>
                      <%= error_message %>.
                  <% end %>
                  </div>
              <% end %>

          </td>      
          </tr>     
      <% end %>    
      <% end %>  
  </tbody>
  </table>
  <% invalid = @restaurant.errors.include?(:schedules) %>
  <% if invalid %>
  <div class="invalid-feedback d-block">
      <% @restaurant.errors.full_messages_for(:schedules).each do |error_message| %>
      <%= error_message %>.
      <% end %>
  </div>
  <% end %>
  <%# Schedule table %>
  
  <%= f.submit %>
<% end %>
<%= link_to "Back", restaurants_path %>